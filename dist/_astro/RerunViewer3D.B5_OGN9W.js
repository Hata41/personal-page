import{r as _}from"./index.Dy6lLLXr.js";var g={exports:{}},w={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b;function k(){if(b)return w;b=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,s,o){var a=null;if(o!==void 0&&(a=""+o),s.key!==void 0&&(a=""+s.key),"key"in s){o={};for(var i in s)i!=="key"&&(o[i]=s[i])}else o=s;return s=o.ref,{$$typeof:n,type:r,key:a,ref:s!==void 0?s:null,props:o}}return w.Fragment=e,w.jsx=t,w.jsxs=t,w}var E;function L(){return E||(E=1,g.exports=k()),g.exports}var f=L();const j="modulepreload",S=function(n){return"/personal-page/"+n},x={},C=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let a=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),d=i?.nonce||i?.getAttribute("nonce");s=a(t.map(l=>{if(l=S(l),l in x)return;x[l]=!0;const u=l.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${p}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":j,u||(h.as="script"),h.crossOrigin="",h.href=l,d&&h.setAttribute("nonce",d),document.head.appendChild(h),u)return new Promise(($,A)=>{h.addEventListener("load",$),h.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return s.then(a=>{for(const i of a||[])i.status==="rejected"&&o(i.reason);return e().catch(o)})};let v=null,y=null;async function T(n){return(await C(async()=>{const{default:e}=await import("./re_viewer.DACxvNpi.js");return{default:e}},[])).default}async function P(n){//!<INLINE-MARKER-OPEN>
if(n)return fetch(new URL("./re_viewer_bg.wasm",n));return fetch(new URL("/personal-page/_astro/re_viewer_bg.Hmd6z9HG.wasm",import.meta.url));//!<INLINE-MARKER-CLOSE>
}async function U(n){(!v||!y)&&([v,y]=await Promise.all([T(),WebAssembly.compileStreaming(P(n))]));let e=v();return await e(y),class extends e.WebHandle{free(){super.free(),e.deinit()}}}let m=null;function V(){const n=new Uint8Array(16);return crypto.getRandomValues(n),Array.from(n).map(e=>e.toString(16).padStart(2,"0")).join("")}function q(n){return new Promise(e=>setTimeout(e,n))}class W{#l=V();#e=null;#t=null;#r="stopped";#s=!1;#n=!1;constructor(){I(),F()}async start(e,t,r){if(t??=document.body,r??={},r=r&&{...r},this.#n=r.allow_fullscreen||!1,this.#r!=="stopped")return;this.#r="starting",this.#t=document.createElement("canvas"),this.#t.style.width=r.width??"640px",this.#t.style.height=r.height??"360px",t.append(this.#t),await q(0);let s=r?.base_url;s&&delete r.base_url;let o=await U(s);if(this.#r!=="starting")return;const a=this.#n?{get_state:()=>this.#s,on_toggle:()=>this.toggle_fullscreen()}:void 0,i=d=>{this.#d(d);let l=JSON.parse(d);this.#o(l.type,l)};this.#e=new o({...r,fullscreen:a,on_viewer_event:i});try{await this.#e.start(this.#t)}catch(d){throw this.stop(),d}this.#r==="starting"&&(this.#r="ready",this.#o("ready"),e&&this.open(e))}#c=new Set;#d(e){for(const t of this.#c)t(e)}_on_raw_event(e){return this.#c.add(e),()=>this.#c.delete(e)}#i=new Map;#o(e,...t){setTimeout(()=>{const r=this.#i.get(e);if(r)for(const[s,{once:o}]of[...r.entries()])s(...t),o&&r.delete(s)},0)}on(e,t){const r=this.#i.get(e)??new Map;return r.set(t,{once:!1}),this.#i.set(e,r),()=>r.delete(t)}once(e,t){const r=this.#i.get(e)??new Map;return r.set(t,{once:!0}),this.#i.set(e,r),()=>r.delete(t)}off(e,t){const r=this.#i.get(e);r?r.delete(t):console.warn("Attempted to call `WebViewer.off` with an unregistered callback. Are you passing in the same function instance?")}get canvas(){return this.#t}get ready(){return this.#r==="ready"}open(e,t={}){if(!this.#e)throw new Error(`attempted to open \`${e}\` in a stopped viewer`);const r=Array.isArray(e)?e:[e];for(const s of r)try{this.#e.add_receiver(s,t.follow_if_http)}catch(o){throw this.stop(),o}}close(e){if(!this.#e)throw new Error(`attempted to close \`${e}\` in a stopped viewer`);const t=Array.isArray(e)?e:[e];for(const r of t)try{this.#e.remove_receiver(r)}catch(s){throw this.stop(),s}}stop(){if(this.#r!=="stopped"){this.#n&&this.#t&&this.#s&&this.#a(),this.#r="stopped",this.#t?.remove();try{this.#e?.destroy(),this.#e?.free()}catch(e){throw this.#e=null,e}this.#t=null,this.#e=null,this.#s=!1,this.#n=!1}}open_channel(e="rerun-io/web-viewer"){if(!this.#e)throw new Error(`attempted to open channel "${e}" in a stopped web viewer`);const t=crypto.randomUUID();try{this.#e.open_channel(t,e)}catch(i){throw this.stop(),i}const r=i=>{if(!this.#e)throw new Error(`attempted to send data through channel "${e}" to a stopped web viewer`);try{this.#e.send_rrd_to_channel(t,i)}catch(d){throw this.stop(),d}},s=i=>{if(!this.#e)throw new Error(`attempted to send data through channel "${e}" to a stopped web viewer`);try{this.#e.send_table_to_channel(t,i)}catch(d){throw this.stop(),d}},o=()=>{if(!this.#e)throw new Error(`attempted to send data through channel "${e}" to a stopped web viewer`);try{this.#e.close_channel(t)}catch(i){throw this.stop(),i}},a=()=>this.#r;return new z(r,s,o,a)}override_panel_state(e,t){if(!this.#e)throw new Error(`attempted to set ${e} panel to ${t} in a stopped web viewer`);try{this.#e.override_panel_state(e,t)}catch(r){throw this.stop(),r}}toggle_panel_overrides(e){if(!this.#e)throw new Error("attempted to toggle panel overrides in a stopped web viewer");try{this.#e.toggle_panel_overrides(e)}catch(t){throw this.stop(),t}}get_active_recording_id(){if(!this.#e)throw new Error("attempted to get active recording id in a stopped web viewer");return this.#e.get_active_recording_id()??null}set_active_recording_id(e){if(!this.#e)throw new Error(`attempted to set active recording id to ${e} in a stopped web viewer`);this.#e.set_active_recording_id(e)}get_playing(e){if(!this.#e)throw new Error("attempted to get play state in a stopped web viewer");return this.#e.get_playing(e)||!1}set_playing(e,t){if(!this.#e)throw new Error(`attempted to set play state to ${t?"playing":"paused"} in a stopped web viewer`);this.#e.set_playing(e,t)}get_current_time(e,t){if(!this.#e)throw new Error("attempted to get current time in a stopped web viewer");return this.#e.get_time_for_timeline(e,t)||0}set_current_time(e,t,r){if(!this.#e)throw new Error(`attempted to set current time to ${r} in a stopped web viewer`);this.#e.set_time_for_timeline(e,t,r)}get_active_timeline(e){if(!this.#e)throw new Error("attempted to get active timeline in a stopped web viewer");return this.#e.get_active_timeline(e)??null}set_active_timeline(e,t){if(!this.#e)throw new Error(`attempted to set active timeline to ${t} in a stopped web viewer`);this.#e.set_active_timeline(e,t)}get_time_range(e,t){if(!this.#e)throw new Error("attempted to get time range in a stopped web viewer");return this.#e.get_timeline_time_range(e,t)}toggle_fullscreen(){if(this.#n){if(!this.#e||!this.#t)throw new Error("attempted to toggle fullscreen mode in a stopped web viewer");this.#s?this.#a():this.#h()}}set_credentials(e,t){if(!this.#e)throw new Error("attempted to set credentials in a stopped web viewer");this.#e.set_credentials(e,t)}#a=()=>{};#h=()=>{m?.();const e=this.#t,t=e.getBoundingClientRect(),r=()=>{e.style.left=t.left+"px",e.style.top=t.top+"px",e.style.width=t.width+"px",e.style.height=t.height+"px"},s=()=>e.removeAttribute("style"),o=a=>setTimeout(()=>requestAnimationFrame(a),R);e.classList.add(c.fullscreen_base,c.fullscreen_rect),r(),requestAnimationFrame(()=>{this.#s&&(e.classList.add(c.transition),o(()=>{this.#s&&(s(),document.body.classList.add(c.hide_scrollbars),document.documentElement.classList.add(c.hide_scrollbars),this.#o("fullscreen",!0))}))}),this.#a=()=>{document.body.classList.remove(c.hide_scrollbars),document.documentElement.classList.remove(c.hide_scrollbars),r(),e.classList.remove(c.fullscreen_rect),o(()=>{this.#s||(s(),e.classList.remove(c.fullscreen_base,c.transition))}),m=null,this.#s=!1,this.#o("fullscreen",!1)},m=()=>this.#a(),this.#s=!0}}class z{#l;#e;#t;#r;#s=!1;constructor(e,t,r,s){this.#l=e,this.#e=t,this.#t=r,this.#r=s}get ready(){return!this.#s&&this.#r()==="ready"}send_rrd(e){this.ready&&this.#l(e)}send_table(e){this.ready&&this.#e(e)}close(){this.ready&&(this.#t(),this.#s=!0)}}const c={hide_scrollbars:"rerun-viewer-hide-scrollbars",fullscreen_base:"rerun-viewer-fullscreen-base",fullscreen_rect:"rerun-viewer-fullscreen-rect",transition:"rerun-viewer-transition"},R=100,D=`
  html.${c.hide_scrollbars},
  body.${c.hide_scrollbars} {
    scrollbar-gutter: auto !important;
    overflow: hidden !important;
  }

  .${c.fullscreen_base} {
    position: fixed;
    z-index: 99999;
  }

  .${c.transition} {
    transition: all ${R/1e3}s linear;
  }

  .${c.fullscreen_rect} {
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
  }
`;function I(){const n="__rerun_viewer_style";if(document.getElementById(n))return;const e=document.createElement("style");e.id=n,e.appendChild(document.createTextNode(D)),document.head.appendChild(e)}function F(){window.addEventListener("keyup",n=>{n.code==="Escape"&&m?.()})}function M(){const[n,e]=_.useState(null),t=_.useRef(null),r=_.useRef(null);return _.useEffect(()=>{if(typeof window>"u"||!t.current)return;const s=new W;return r.current=s,(async()=>{try{const a=window.location.origin,i="/personal-page",d=`${a}${i}/data/data.rrd`.replace(/([^:])\/\//g,"$1/"),l=`${a}${i}/`.replace(/([^:])\/\//g,"$1/");await s.start(d,t.current,{width:"100%",height:"100%",base_url:l,hide_welcome_screen:!0})}catch(a){console.error("Rerun Viewer failed to start:",a),e(a?.message||"Failed to initialize the 3D viewer. This might be due to WebAssembly or WebGL issues in your browser.")}})(),()=>{r.current&&(r.current.stop(),r.current=null)}},[]),f.jsx("div",{ref:t,style:{width:"100%",height:"600px",position:"relative",backgroundColor:"#000",borderRadius:"8px",overflow:"hidden"},children:n&&f.jsxs("div",{style:{position:"absolute",top:0,left:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",color:"#ff4444",padding:"20px",textAlign:"center",backgroundColor:"rgba(17, 17, 17, 0.9)",zIndex:10},children:[f.jsx("h3",{children:"Failed to load 3D Viewer"}),f.jsx("p",{children:n}),f.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"10px",padding:"8px 16px",backgroundColor:"#333",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Retry"})]})})}export{M as default};
